<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>All Taluks - Uttara Kannada</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <link rel="stylesheet" href="css/style.css">
</head>

<body class="bg-gray-50">
  <header class="header">
    <div class="container nav">
      <img src="assets/icons/favicon.png" height="50px" width="50px">
      <a href="index.html" class="logo text-xl font-bold" data-i18n="app_title">Uttara Kannada</a>
      <div class="flex items-center gap-2">
        <button onclick="history.back()" class="back-btn"><i class="fa-solid fa-arrow-left"></i> <span
            data-i18n="btn_back">Back</span></button>
        <nav class="nav-links hidden md:flex"><a href="index.html" class="px-3" data-i18n="btn_home">Home</a><a
            href="about.html" class="px-3" data-i18n="nav_about">About</a></nav>
      </div>
    </div>
  </header>

  <main>
    <section class="sub-header" data-aos="fade-down"
      style="background: linear-gradient(135deg, #0891b2 0%, #06b6d4 50%, #14b8a6 100%); padding: 3rem 0; color: white;">
      <div class="container">
        <h1 style="color: white; font-size: 2.5rem; font-weight: 800; text-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);"
          data-i18n="taluks_title">
          Taluks of Uttara Kannada</h1>
        <p class="text-muted" style="color: rgba(255, 255, 255, 0.9); font-size: 1.1rem;" data-i18n="taluks_sub">Click a
          taluk to view its
          tourist places</p>
      </div>
    </section>

    <section class="py-6">
      <div class="container">
        <input id="search" placeholder="Search taluk" class="w-full p-3 rounded border" data-aos="fade-up"
          data-i18n="search_placeholder" />
        <div id="talukGrid" class="taluk-list mt-4">
          <!-- cards inserted here -->
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container">
      <small class="text-muted" data-i18n="footer_text">&copy; 2025 Uttara Kannada Tourism</small>
    </div>
  </footer>

  <script src="js/translations.js"></script>


  <script>
    // Initialize AOS
    AOS.init({
      duration: 800,
      once: true,
      offset: 100
    });

    function resolveImage(img) { if (!img) return 'https://via.placeholder.com/400x240?text=No+Image'; if (/^https?:\/\//i.test(img)) return img; return 'assets/images/' + img }
    Promise.all([
      fetch('data/places.json?v=' + Date.now()).then(r => r.json()),
      fetch('data/images.json?v=' + Date.now()).then(r => r.json())
    ])
      .then(([placesData, imagesData]) => {
        const container = document.getElementById('talukGrid');

        // Build image map
        const imageMap = {};
        Object.keys(imagesData).forEach(taluk => {
          const places = imagesData[taluk] || [];
          places.forEach(p => {
            if (p.name && p.image) {
              imageMap[p.name.toLowerCase()] = p.image;
            }
          });
        });

        const taluks = Object.keys(placesData).sort();
        // Render Function
        function renderTaluks() {
          container.innerHTML = '';
          const lang = window.currentLanguage || localStorage.getItem('uk_lang') || 'en';

          taluks.forEach((tk, index) => {
            const places = placesData[tk] || [];
            const count = places.length;

            // Try to find an image for the first place in the taluk
            let img = 'https://via.placeholder.com/400x240?text=' + encodeURIComponent(tk);
            if (places.length > 0) {
              const firstPlaceName = places[0].name.toLowerCase();
              if (imageMap[firstPlaceName]) {
                img = imageMap[firstPlaceName];
              } else if (places[0].image && /^https?:\/\//i.test(places[0].image)) {
                img = places[0].image;
              }
            }

            // Translate Taluk Name
            let displayName = tk;
            const talukKey = 'taluk_' + tk.toLowerCase();
            if (translations[lang] && translations[lang][talukKey]) {
              displayName = translations[lang][talukKey];
            }

            const a = document.createElement('a');
            a.className = 'taluk-card';
            a.href = tk.toLowerCase() + '.html';
            a.setAttribute('data-aos', 'fade-up');
            a.setAttribute('data-aos-delay', (index % 4) * 100);
            a.innerHTML = `
                <div class="taluk-card-image">
                  <img src="${img}" alt="${tk}" />
                </div>
                <div class="taluk-card-content">
                  <h3>${displayName}</h3>
                  <p>${count} place${count !== 1 ? 's' : ''}</p>
                </div>
              `;
            container.appendChild(a);
          });
          AOS.refresh();
        }

        renderTaluks();

        // Listen for language changes
        window.addEventListener('languageChanged', (e) => {
          renderTaluks();
        });

        // search
        const searchEl = document.getElementById('search');
        searchEl.addEventListener('input', (e) => {
          const q = e.target.value.toLowerCase();
          Array.from(container.children).forEach(card => {
            // Search both English key (href) and visible text
            const href = card.getAttribute('href').replace('.html', '').toLowerCase();
            const text = card.textContent.toLowerCase();
            if (href.includes(q) || text.includes(q)) {
              card.style.display = 'block';
              // Fix for AOS compatibility: ensure element is visible
              card.style.opacity = '1';
              card.style.visibility = 'visible';
            } else {
              card.style.display = 'none';
            }
          });
          // Refresh AOS layout updates
          setTimeout(() => AOS.refresh(), 100);
        });
      })
      .catch(e => console.error(e));
  </script>
    <script src="js/dev.js"></script>
</body>

</html>